/*! screen-sharing-sample build:0.1.0, production. Copyright(C) 2013-2014 www.OpenFlint.org */!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(){String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}}),Array.prototype.find||(Array.prototype.find=function(a){var b,c,d,e,f,g,h;if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(d=Object(this),c=d.length>>>0,e=arguments[1],b=g=0,h=c-1;h>=0?h>=g:g>=h;b=h>=0?++g:--g)if(f=d[b],a.call(e,f,b,d))return f;return void 0}),Array.prototype.findIndex||(Array.prototype.findIndex=function(a){var b,c,d,e,f,g,h;if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(d=Object(this),c=d.length>>>0,e=arguments[1],b=g=0,h=c-1;h>=0?h>=g:g>=h;b=h>=0?++g:--g)if(f=d[b],a.call(e,f,b,d))return b;return-1})},{}],2:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("eventemitter3"),c=function(a){function b(){this.callid=1,this.temporaryAsyncStorage={},window.addEventListener("message",function(a){return function(b){var c;return"page-script"===(null!=(c=b.data)?c.to:void 0)?a._receive(b.data.payload):void 0}}(this))}return f(b,a),b.instance=null,b.getInstance=function(){return b.instance||(b.instance=new b),b.instance},b.prototype.call2=function(a,b,c){var d,e;return e=function(){return function(a){return"function"==typeof c?c(!0,a):void 0}}(this),d=function(){return function(a){return"function"==typeof c?c(!1,a):void 0}}(this),this.call(a,b,e,d)},b.prototype.call=function(a,b,c,d){var e,f;return e=this._genCallId(),f=!0,(c||d)&&(this.temporaryAsyncStorage[e]={success:c,error:d,onetime:f}),this._send({callid:e,method:a,params:b})},b.prototype._send=function(a){return window.postMessage({to:"content-script",payload:a},"*")},b.prototype._genCallId=function(){return this.callid++},b.prototype._receive=function(a){var b;return a.callid&&(void 0===typeof this.temporaryAsyncStorage[a.callid]&&console.log("Nothing stored for call ID: "+a.callid),b=this.temporaryAsyncStorage[a.callid],b&&b[a.status]&&b[a.status](a.content),b&&b.onetime)?delete this.temporaryAsyncStorage[a.callid]:void 0},b}(d),b.exports=c},{eventemitter3:11}],3:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),e=a("./NativeMethods"),d=function(a){function b(a){this.host=a.host,this.friendlyName=a.friendlyName}return g(b,a),b}(c),b.exports=d},{"./NativeMethods":6,eventemitter3:11}],4:[function(a,b){var c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("eventemitter3"),c=a("./Bridge"),e=a("./FlintDevice"),f=function(a){function b(a){this.device=a,this.bridge=c.getInstance(),this.launched=!1,this.useIpc=!1,this.maxInactive=-1,this.additionalDatas={},this.token=null,this.heartbeatInterval=0}return h(b,a),b.prototype.launch=function(a){if(this.launched)throw"Application already launched ";return this.appId=a.appId,this.appUrl=a.appUrl,"undefined"!=typeof a.useIpc&&(this.useIpc=a.useIpc),"undefined"!=typeof a.maxInactive&&(this.maxInactive=a.maxInactive),this._getStatus(function(b){return function(c){return console.log("status: ",c),console.log("@appState: ",b.appState),console.log("@appName: ",b.appName),"running"!==b.appState||b.appName!==b.appId?b._launch(!1):(null!=a?a.relaunchIfRunning:void 0)?b._launch(!0):void 0}}(this))},b.prototype._launch=function(a){var b,c;return b="launch",a&&(b="relaunch"),c={url:"http://"+this.device.host+":9431/apps/"+this.appId,headers:{"Content-Type":"application/json"},data:{type:b,app_info:{url:this.appUrl,useIpc:this.useIpc,maxInactive:this.maxInactive}}},this.bridge.call2("http:post",c,function(){return function(a,b){return a?console.log("_launch reply ",b):console.log("_launch error ",b)}}(this))},b.prototype._getStatus=function(a){var b,c,d,e;return c={"Content-Type":"application/json",Accept:"application/xml; charset=utf8"},this.token&&(c.Authorization=this.token),e="http://"+this.device.host+":9431/apps/"+this.appId,d=function(b){return function(c){return console.log("_getStatus reply ",c),b._parseStatus(c.data),"function"==typeof a?a(c.data):void 0}}(this),b=function(){return function(a){return console.log("_getStatus error ",a)}}(this),this.bridge.call("http:get",{url:e},d,b)},b.prototype._parseStatus=function(a){var b,c,d,e,f,g,h,i,j,k,l;if(f=a.split("\n"),f.splice(0,1),i=f.join(""),h=new DOMParser,c=h.parseFromString(i,"text/xml"),this.appName=c.getElementsByTagName("name")[0].innerHTML,this.appState=c.getElementsByTagName("state")[0].innerHTML,g=c.getElementsByTagName("link"),g&&g[0]&&(this.appHref=g[0].getAttribute("href")),b=c.getElementsByTagName("additionalData"),(null!=b?b.length:void 0)>0&&(e=b[0].childNodes)){for(l=[],d=j=0,k=e.length-1;k>=0?k>=j:j>=k;d=k>=0?++j:--j)l.push(e[d].tagName?this.additionalDatas[e[d].tagName]=e[d].innerHTML:void 0);return l}},b}(d),b.exports=f},{"./Bridge":2,"./FlintDevice":3,eventemitter3:11}],5:[function(a,b){var c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("eventemitter3"),e=a("./FlintDevice"),g=a("./SimpleServiceDiscovery"),c=a("./Bridge"),f=function(a){function b(){this.devices={},this.bridge=c.getInstance(),this.ssdp=new g,this.ssdp.registerTarget("urn:dial-multiscreen-org:service:dial:1"),this.ssdp.on("notify",function(a){return function(b,c){return a._fetchDeviceDesc(b,c.host)}}(this)),this.ssdp.on("response",function(a){return function(b,c){return a._fetchDeviceDesc(b,c.host)}}(this)),this.ssdp.search(3e4)}return i(b,a),b.prototype.getDeviceList=function(){return this.devices},b.prototype._found=function(a){var b;return this.devices[a.host]?void 0:(b=new e(a),b.on("offline",function(b){return function(){return delete b.devices[a.host]}}(this)),this.devices[a.host]=b,this.emit("devicefound",b))},b.prototype._fetchDeviceDesc=function(a,b){var c;return c=a.location+"/ssdp/device-desc.xml",this.bridge.call("http:get",{url:c},function(c){return function(d){return c._parseDeviceDesc(d.data,b,a.location)}}(this),function(){return function(){}}(this))},b.prototype._parseDeviceDesc=function(a,b,c){var d,e,f,g;try{if(g=null,window.DOMParser?(f=new DOMParser,g=f.parseFromString(a,"text/xml")):(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(a)),d=g.querySelectorAll("device"),d.length>0)return this._parseSingleDeviceDesc(d[0],b,c)}catch(h){return e=h,console.error(e)}},b.prototype._parseSingleDeviceDesc=function(a,b,c){var d,e,f,g,h;return d=a.querySelector("deviceType").innerHTML,h=a.querySelector("UDN").innerHTML,e=a.querySelector("friendlyName").innerHTML,f=a.querySelector("manufacturer").innerHTML,g=a.querySelector("modelName").innerHTML,this._found({host:b,urlBase:c,deviceType:d,udn:h,friendlyName:e,manufacturer:f,modelName:g})},b.prototype._getAbsoluteURL=function(a,b){var c;return/^https?:\/\//.test(a)?a:(c=new URL(a,b),c.toString())},b}(d),b.exports=f},{"./Bridge":2,"./FlintDevice":3,"./SimpleServiceDiscovery":9,eventemitter3:11}],6:[function(a,b){var c;c=function(){function a(){}return a.checkPluginAvailable=function(){return a.loadPlugin(),a.plugin?!0:void 0},a.loadPlugin=function(){return a.plugin=loadSockitPlugin()},a.isAvailable=function(){return"undefined"!=typeof a.plugin},a.createWebSocket=function(b){return a.checkPluginAvailable()&&a.plugin.createWebSocket(b),null},a.httpGet=function(){var b;return a.checkPluginAvailable()?(b=a.plugin.createHttpRequest(),b.setRequestHeader("Content-Type",""),b.send()):void 0},a}(),b.exports=c},{}],7:[function(a,b){var c,d;c=a("./Bridge"),d=function(){function a(a){var b,d;this.url=a,this.bridge=c.getInstance(),this.pendingOps=[],this.readyState=0,d=function(a){return function(b){var c;for(a.id=b.id,console.log("Websocket ID : ",b.id),a._pollEvent(),c=[];a.pendingOps.length>0;)c.push(a.pendingOps.shift()());return c}}(this),b=function(){return function(){}}(this),this.bridge.call("ws:create",{url:this.url},d,b)}return a.prototype.send=function(a){var b,c;return this.id?(c=function(){return function(){}}(this),b=function(){return function(){}}(this),this.bridge.call("ws:send",{id:this.id,data:a},c,b)):this.pendingOps.push(function(b){return function(){return b.send(a)}}(this))},a.prototype.close=function(){var a;return this.id?a=function(b){return function(){var c;return c=function(){},b.bridge.call("ws:close",{id:b.id},a,c)}}(this):this.pendingOps.push(function(a){return function(){return a.close()}}(this))},a.prototype._pollEvent=function(){return this.bridge.call2("ws:poll-event",{id:this.id},function(a){return function(b,c){return b?(a._updateStatus(c),a._onEvent(c),a._pollEvent()):console.log("websocket error "+c.status)}}(this))},a.prototype._updateStatus=function(a){return a.readyState?this.readyState=a.readyState:void 0},a.prototype._onEvent=function(a){switch(a.type){case"onopen":return this.onopen?this.onopen():this.emit("open");case"onclose":return this.onclose?this.onclose():this.emit("close");case"onerror":return this.onerror?this.onerror():this.emit("error");case"onmessage":return this.onmessage?this.onmessage({data:a.data}):this.emit("close");default:return console.log("Unknow event type : "+a.type)}},a}(),b.exports=d},{"./Bridge":2}],8:[function(a,b){var c,d;c=a("./Bridge"),d=function(){function a(a){var b,d;this.objParameters=a,this.bridge=c.getInstance(),this.readyState=0,this.status=0,this.pendingOps=[],d=function(a){return function(b){var c;for(a.id=b.id,a._pollEvent(),c=[];a.pendingOps.length>0;)c.push(a.pendingOps.shift()());return c}}(this),b=function(){return function(){return console.log("xhr error "+content.error)}}(this),this.bridge.call("xhr:create",{},d,b)}return a.prototype.open=function(a,b){var c;return this.id?(c={id:this.id,method:a,url:b},this.bridge.call2("xhr:open",c,function(){return function(a,b){return a?void 0:console.log("xhr error "+b.error)}}(this))):this.pendingOps.push(function(c){return function(){return c.open(a,b)}}(this))},a.prototype.send=function(a){var b;return this.id?(b={id:this.id,data:a},this.bridge.call2("xhr:send",b,function(){return function(a,b){return a?void 0:console.log("xhr error "+b.error)}}(this))):this.pendingOps.push(function(b){return function(){return b.send(a)}}(this))},a.prototype._pollEvent=function(){return this.bridge.call2("xhr:poll-event",{id:this.id},function(a){return function(b,c){return b?(a._updateStatus(c),a._onEvent(c.type),a._pollEvent()):console.log("xhr error "+c.status)}}(this))},a.prototype._updateStatus=function(a){return a.readyState&&(this.readyState=a.readyState),a.responseHeaders&&(this.responseHeaders=a.responseHeaders),a.responseText&&(this.responseText=a.responseText),a.responseHeaders&&(this.responseHeaders=a.responseHeaders),a.status&&(this.status=a.status),a.statusText?this.statusText=a.statusText:void 0},a.prototype._onEvent=function(a){return"onreadystatechange"!==a?console.log("Unknow event type : "+a):this.onreadystatechange?this.onreadystatechange():void 0},a}(),b.exports=d},{"./Bridge":2}],9:[function(a,b){var c,d,e,f,g,h,i,j,k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a("../common/Polyfill"),c=a("eventemitter3"),h=1900,d="239.255.255.250",e=10,f="M-SEARCH * HTTP/1.1\r\nHOST: "+d+":"+h+'\r\nMAN: "ssdp:discover"\r\nMX: '+e+"\r\nST: %SEARCH_TARGET%\r\n\r\n",i=/HTTP\/\d{1}\.\d{1} \d+ .*/,g=/^([^:]+):\s*(.*)$/,j=function(a){function b(){this._targets=[]}return l(b,a),b.prototype.search=function(a){return a=a||0,a>0&&(this._searchRepeat=setInterval(function(a){return function(){return a._search()}}(this),a)),this._search()},b.prototype.stopSearch=function(){return this._searchRepeat?clearInterval(this._searchRepeat):void 0},b.prototype.registerTarget=function(a){return this._targets.indexOf(a)<0?this._targets.push(a):void 0},b.prototype._usingLAN=function(){return!0},b.prototype._search=function(){var a,b;if(this._usingLAN())return this._udpClient||(b=loadSockitPlugin(),console.log(b),this._udpServer=b.createUdpServer(h,{multicast:!0,multicastTTL:16,multicastGroup:d,reuseAddress:!0}),this._udpServer.addEventListener("data",function(a){return function(b){return a._onmessage({host:b.getHost(),data:b.read()})}}(this)),this._udpServer.listen(),this._udpClient=b.createUdpClient(d,h,{multicast:!0,multicastTTL:16})),a=f,this._targets.forEach(function(b){return function(c){var d;return d=a.replace("%SEARCH_TARGET%",c),console.log(d),b._udpClient.send(d)}}(this))},b.prototype.shutdown=function(){return this._udpServer&&(this._udpServer.close(),delete this._udpServer),this._udpClient?(this._udpClient.close(),delete this._udpClient):void 0},b.prototype._onmessage=function(a){var b,c,d,e,f,g;return f=a.data,d=f.toString().split("\r\n"),b=d.shift(),e=i.test(b)?"RESPONSE":b.split(" ")[0].toUpperCase(),c={},d.forEach(function(){return function(a){var b;return a.length&&(b=a.match(/^([^:]+):\s*(.*)$/))?c[b[1].toLowerCase()]=b[2]:void 0}}(this)),g={host:a.host},"M-SEARCH"===e?this._msearch(c,g):"RESPONSE"===e?this._response(c,g):"NOTIFY"===e?this._notify(c,g):void 0},b.prototype._response=function(a,b){return!a.st&&a.nt&&(a.st=a.nt),a.location&&this._targets.indexOf(a.st)>=0?this.emit("response",a,b):void 0},b.prototype._notify=function(a,b){return"ssdp:alive"===a.nts?this.emit("notify",a,b):"ssdp:byebye"===a.nts?this.emit("advertise-bye",a):void 0},b.prototype._msearch=function(){},b}(c),b.exports=j},{"../common/Polyfill":1,eventemitter3:11}],10:[function(a){window.PrivWebSocket=a("./PrivWebSocket"),window.PrivXMLHttpRequest=a("./PrivXMLHttpRequest"),window.FlintDevice=a("./FlintDevice"),window.FlintDeviceScanner=a("./FlintDeviceScanner"),window.FlintDeviceManager=a("./FlintDeviceManager")},{"./FlintDevice":3,"./FlintDeviceManager":4,"./FlintDeviceScanner":5,"./PrivWebSocket":7,"./PrivXMLHttpRequest":8}],11:[function(a,b){"use strict";function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){}d.prototype._events=void 0,d.prototype.listeners=function(a){if(!this._events||!this._events[a])return[];for(var b=0,c=this._events[a].length,d=[];c>b;b++)d.push(this._events[a][b].fn);return d},d.prototype.emit=function(a,b,c,d,e,f){if(!this._events||!this._events[a])return!1;var g,h,i,j=this._events[a],k=j.length,l=arguments.length,m=j[0];if(1===k){switch(m.once&&this.removeListener(a,m.fn,!0),l){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,b),!0;case 3:return m.fn.call(m.context,b,c),!0;case 4:return m.fn.call(m.context,b,c,d),!0;case 5:return m.fn.call(m.context,b,c,d,e),!0;case 6:return m.fn.call(m.context,b,c,d,e,f),!0}for(h=1,g=new Array(l-1);l>h;h++)g[h-1]=arguments[h];m.fn.apply(m.context,g)}else for(h=0;k>h;h++)switch(j[h].once&&this.removeListener(a,j[h].fn,!0),l){case 1:j[h].fn.call(j[h].context);break;case 2:j[h].fn.call(j[h].context,b);break;case 3:j[h].fn.call(j[h].context,b,c);break;default:if(!g)for(i=1,g=new Array(l-1);l>i;i++)g[i-1]=arguments[i];j[h].fn.apply(j[h].context,g)}return!0},d.prototype.on=function(a,b,d){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),this._events[a].push(new c(b,d||this)),this},d.prototype.once=function(a,b,d){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),this._events[a].push(new c(b,d||this,!0)),this},d.prototype.removeListener=function(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b)for(var f=0,g=d.length;g>f;f++)d[f].fn!==b&&d[f].once!==c&&e.push(d[f]);return this._events[a]=e.length?e:null,this},d.prototype.removeAllListeners=function(a){return this._events?(a?this._events[a]=null:this._events={},this):this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.EventEmitter=d,d.EventEmitter2=d,d.EventEmitter3=d,"object"==typeof b&&b.exports&&(b.exports=d)},{}]},{},[10]);